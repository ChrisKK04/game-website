{% extends "layout.html" %}
<!-- Search page -->
{% block title%}Search{% endblock %}

{% block content %}
<h1>Search</h1>
<hr />

<div class="search_form"> <!-- game search -->
  <form action="/search" method="get">
    <b>Game search</b> <br />

    <p>
      <label for="title">Title</label>: <br />
      <input id="title" type="text" name="title" />
    </p>

    <p>
      <label for="description">Description</label>: <br />
      <textarea id="description" name="description" rows="5" cols="60"></textarea>
    </p>

    <p>
      Categories: <br />
      {% for category in all_classes['Category'] %}
        {% if filled %}
          {% if category in filled.classes['Category'] %}
            <label>
              <input type="checkbox" name="classes" value="Category:{{ category }}" checked /> {{ category }}
            </label>
          {% else %}
            <label>
              <input type="checkbox" name="classes" value="Category:{{ category }}" /> {{ category }}
            </label>
          {% endif %}
        {% else %}
          <label>
            <input type="checkbox" name="classes" value="Category:{{ category }}" /> {{ category }}
          </label>
        {% endif %}
        {% if loop.index % 5 == 0 %}
          <br />
        {% endif %}
      {% endfor %}
    </p>

    <p>
      Average review score (0-5): <br />
      <input id="above" type="radio" name="game_score_type" value="1" checked />
      <label for="above">Above</label>
      <input id="below" type="radio" name="game_score_type" value="0" />
      <label for="below">Below</label>
      <br />
      <input type="number" name="game_score" min="0" max="5" step="0.1" />
    </p>

    <p>
      <label for="publisher">Publisher</label>: <br />
      <input id="publisher" type="text" name="publisher" />
    </p>

    <input type="hidden" name="search_type" value="game_search" />
    <input type="submit" value="Search games" />
  </form>
</div>

<div class="search_form"> <!-- review search -->
  <form action="/search" method="get">
    <b>Review search</b> <br />
    
    <p>
      <label for="content">Content</label>: <br />
      {% if reviews_filled %}
        <textarea id="content" name="content" rows="5" cols="60">{{ reviews_filled.content }}</textarea>
      {% else %}
        <textarea id="content" name="content" rows="5" cols="60"></textarea>
      {% endif %}
    </p>

    <p>
      <label for="review_score">Review score</label>:
      <select id="review_score" name="review_score">
        {% if reviews_filled %}
          {% for score in range(1, 6) %}
            {% if reviews_filled.review_score == score|string %}
              <option value="{{ score }}" selected >{{ score }}</option>
            {% else %}
              <option value="{{ score }}">{{ score }}</option>
            {% endif %}
          {% endfor %}
        {% else %}
          {% for score in range(1, 6) %}
            <option value="{{ score }}">{{ score }}</option>
          {% endfor %}
        {% endif %}
      </select>
      <br />

      <input id="review_any" type="radio" name="review_score_type" value="0" checked />
      <label for="review_any">Any</label>
      {% if reviews_filled %}
        {% if reviews_filled.review_score_type == "1" %}
          <input id="review_above" type="radio" name="review_score_type" value="1" checked />
        {% else %}
          <input id="review_above" type="radio" name="review_score_type" value="1" />
        {% endif %}
        <label for="review_above">Above</label>
        {% if reviews_filled.review_score_type == "2" %}
          <input id="review_below" type="radio" name="review_score_type" value="2" checked />
        {% else %}
          <input id="review_below" type="radio" name="review_score_type" value="2" />
        {% endif %}
        <label for="review_below">Below</label>
      {% else %}
        <input id="review_above" type="radio" name="review_score_type" value="1" />
        <label for="review_above">Above</label>
        <input id="review_below" type="radio" name="review_score_type" value="2" />
        <label for="review_below">Below</label>
      {% endif %}
      <br />
    </p>

    <input type="hidden" name="search_type" value="review_search" />
    <input type="submit" value="Search reviews" />
  </form>
</div>

<div class="search_form"> <!-- user search -->
  <form action="/search" method="get">
    <b>User search</b> <br />
    
    <p>
      <label for="username">Username</label>: <br />
      {% if users_filled %}
        <input id="username" type="text" name="username" value="{{ users_filled.username }}" />
      {% else %}
        <input id="username" type="text" name="username" />
      {% endif %}
    </p>

    <p>
      {% if users_filled %}
        Type: <br />
        <input id="type_both" type="radio" name="user_type" value="2" checked />
        <label for="type_both">Any</label>

        {% if "0" in users_filled.user_type %}
          <input id="type_reviewer" type="radio" name="user_type" value="0" checked />
        {% else %}
          <input id="type_reviewer" type="radio" name="user_type" value="0" />
        {% endif %}
        <label for="type_reviewer">Reviewer</label>
        
        {% if "1" in users_filled.user_type %}
          <input id="type_developer" type="radio" name="user_type" value="1" checked />
        {% else %}
          <input id="type_developer" type="radio" name="user_type" value="1" />
        {% endif %}
        <label for="type_developer">Developer</label>

      {% else %}
        Type: <br />
        <input id="type_both" type="radio" name="user_type" value="2" checked />
        <label for="type_both">Any</label>
        <input id="type_reviewer" type="radio" name="user_type" value="0" />
        <label for="type_reviewer">Reviewer</label>
        <input id="type_developer" type="radio" name="user_type" value="1" />
        <label for="type_developer">Developer</label>
      {% endif %}
    </p>

    <input type="hidden" name="search_type" value="user_search" />
    <input type="submit" value="Search users" />
  </form>
</div>

{% if reviews | count != 0 %} <!-- review display -->
  <h2>Reviews</h2>
  {% for review in reviews %}
  <div class="review">
    <p>
      <a href="/user/{{ review.user_id }}">{{ review.username }}</a> for <a href="/game/{{ review.game_id}}#{{ review.review_id }}">{{ review.game_title }}</a>
    </p>
    <p>
      ({{ review.sent_at }})
      <br />
      {{ review.content }}
      <br />
      <b>Score: {{ review.score }}</b>
    </p>
  </div>
  {% endfor %}
{% elif reviews == [] %}
  <h2>Reviews</h2>
  <p>
    No reviews match the search
  </p>
{% endif %}

{% if users | count != 0 %} <!-- user display -->
  <h2>Users</h2>
  {% for user in users %}
  <div class="user">
    <p>
    {% if user.developer == 0 %}
      Reviewer <a href="/user/{{ user.id }}">{{ user.username }}</a>
    {% elif user.developer == 1 %}
      Developer <a href="/user/{{ user.id }}">{{ user.username }}</a>
    {% endif %}
    {% if user.image %}
      <br />
      <img src="/profile_picture/{{ user.id }}" alt="User {{ user.username }}'s profile picture" />
    {% endif %}
    </p>
  </div>
  {% endfor %}
{% elif users == [] %}
  <h2>Users</h2>
  <p>
    No users match the search
  </p>
{% endif %}

{% if no_search %}
  <h2>No search given</h2>
{% endif %}

{% endblock %}